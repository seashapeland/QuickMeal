<template>
  <div class="store-wrapper">
    <!-- æ¥¼é¢å›¾ -->
    <div class="floorplan">
      <!-- å¤§é—¨ -->
      <div class="door"></div>

      <!-- å‰å° -->
      <div class="counter">å‰å°</div>

      <!-- æ¡Œä½ï¼ˆå¯è‡ªå®šä¹‰æ•°é‡ã€å¤§å°ã€æ–¹å‘ï¼‰ -->
      <RestaurantTable :size="4" orientation="horiz" label="T1" :theme="tableThemes['T1']"
        :style="{ position:'absolute', top:'20px', left:'20px' }"
        @mouseenter="e => showHoverInfo('T1', tableThemes['T1'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T1')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T2" :theme="tableThemes['T2']"
        :style="{ position:'absolute', top:'140px', left:'20px' }"
        @mouseenter="e => showHoverInfo('T2', tableThemes['T2'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T2')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T3" :theme="tableThemes['T3']"
        :style="{ position:'absolute', top:'260px', left:'20px' }"
        @mouseenter="e => showHoverInfo('T3', tableThemes['T3'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T3')"/>
      <RestaurantTable :size="6" orientation="horiz" label="T4" :theme="tableThemes['T4']"
        :style="{ position:'absolute', top:'380px', left:'20px' }"
        @mouseenter="e => showHoverInfo('T4', tableThemes['T4'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T4')"/>
      <RestaurantTable :size="6" orientation="horiz" label="T5" :theme="tableThemes['T5']"
        :style="{ position:'absolute', top:'500px', left:'20px' }"
        @mouseenter="e => showHoverInfo('T5', tableThemes['T5'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T5')"/>
      <RestaurantTable :size="4" orientation="vert" label="T6" :theme="tableThemes['T6']"
        :style="{ position:'absolute', top:'0px', left:'190px' }"
        @mouseenter="e => showHoverInfo('T6', tableThemes['T6'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T6')"/>
      <RestaurantTable :size="4" orientation="vert" label="T7" :theme="tableThemes['T7']"
        :style="{ position:'absolute', top:'150px', left:'190px' }"
        @mouseenter="e => showHoverInfo('T7', tableThemes['T7'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T7')"/>
      <RestaurantTable :size="4" orientation="vert" label="T8" :theme="tableThemes['T8']"
        :style="{ position:'absolute', top:'290px', left:'190px' }"
        @mouseenter="e => showHoverInfo('T8', tableThemes['T8'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T8')"/>
      <RestaurantTable :size="4" orientation="vert" label="T9" :theme="tableThemes['T9']"
        :style="{ position:'absolute', top:'500px', left:'190px' }"
        @mouseenter="e => showHoverInfo('T9', tableThemes['T9'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T9')"/>
      <RestaurantTable :size="6" orientation="vert" label="T10" :theme="tableThemes['T10']"
        :style="{ position:'absolute', top:'260px', left:'320px' }"
        @mouseenter="e => showHoverInfo('T10', tableThemes['T10'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T10')"/>
      <RestaurantTable :size="6" orientation="vert" label="T11" :theme="tableThemes['T11']"
        :style="{ position:'absolute', top:'260px', left:'450px' }"
        @mouseenter="e => showHoverInfo('T11', tableThemes['T11'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T11')"/>
      <RestaurantTable :size="10" orientation="horiz" label="T12" :width="200" :height="70" :theme="tableThemes['T12']"
        :style="{ position:'absolute', top:'510px', left:'317px' }"
        @mouseenter="e => showHoverInfo('T12', tableThemes['T12'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T12')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T13" :theme="tableThemes['T13']"
        :style="{ position:'absolute', top:'20px', left:'570px' }"
        @mouseenter="e => showHoverInfo('T13', tableThemes['T13'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T13')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T14" :theme="tableThemes['T14']"
        :style="{ position:'absolute', top:'180px', left:'570px' }"
        @mouseenter="e => showHoverInfo('T14', tableThemes['T14'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T14')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T15" :theme="tableThemes['T15']"
        :style="{ position:'absolute', top:'310px', left:'570px' }"
        @mouseenter="e => showHoverInfo('T15', tableThemes['T15'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T15')"/>
      <RestaurantTable :size="6" orientation="vert" label="T16" :theme="tableThemes['T16']"
        :style="{ position:'absolute', top:'490px', left:'590px' }"
        @mouseenter="e => showHoverInfo('T16', tableThemes['T16'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T16')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T17" :theme="tableThemes['T17']"
        :style="{ position:'absolute', top:'20px', left:'710px' }"
        @mouseenter="e => showHoverInfo('T17', tableThemes['T17'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T17')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T18" :theme="tableThemes['T18']"
        :style="{ position:'absolute', top:'180px', left:'710px' }"
        @mouseenter="e => showHoverInfo('T18', tableThemes['T18'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T18')"/>
      <RestaurantTable :size="4" orientation="horiz" label="T19" :theme="tableThemes['T19']"
        :style="{ position:'absolute', top:'310px', left:'710px' }"
        @mouseenter="e => showHoverInfo('T19', tableThemes['T19'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T19')"/>
      <RestaurantTable :size="6" orientation="vert" label="T20" :theme="tableThemes['T20']"
        :style="{ position:'absolute', top:'490px', left:'730px' }"
        @mouseenter="e => showHoverInfo('T20', tableThemes['T20'], e.currentTarget)" @mouseleave="hideHoverInfo" @click="expandAndScrollTo('T20')"/>


      <!-- éš”æ–­ -->
      <!-- middle -->
      <PartitionWall orientation="vertical" :length="100" :style="{top:'-4px', left:'280px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="100" :style="{top:'-4px', left:'545px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="250" :style="{top:'150px', left:'280px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="250" :style="{top:'150px', left:'545px', position:'absolute'}"/>
      <PartitionWall orientation="horizontal" :length="270" :style="{top:'230px', left:'285px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="130" :style="{top:'240px', left:'410px', position:'absolute'}"/>
      <!-- left -->
      <PartitionWall orientation="horizontal" :length="130" :style="{top:'105px', left:'-4px', position:'absolute'}"/>
      <PartitionWall orientation="horizontal" :length="130" :style="{top:'225px', left:'-4px', position:'absolute'}"/>
      <PartitionWall orientation="horizontal" :length="130" :style="{top:'345px', left:'-4px', position:'absolute'}"/>
      <PartitionWall orientation="horizontal" :length="130" :style="{top:'465px', left:'-4px', position:'absolute'}"/>
      <PartitionWall orientation="horizontal" :length="130" :style="{top:'265px', left:'160px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="130" :style="{top:'480px', left:'280px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="130" :style="{top:'480px', left:'545px', position:'absolute'}"/>
      <!-- right -->
      <PartitionWall orientation="horizontal" :length="130" :style="{top:'265px', left:'545px', position:'absolute'}"/>
      <PartitionWall orientation="horizontal" :length="120" :style="{top:'265px', left:'705px', position:'absolute'}"/>
      <PartitionWall orientation="vertical" :length="130" :style="{top:'480px', left:'685px', position:'absolute'}"/>


    </div>
    <!--  Tooltip æµ®å±‚ -->
    <div
      v-if="hoverInfo.visible"
      class="table-tooltip"
      :style="{
        top: `${hoverInfo.y}px`,
        left: `${hoverInfo.x}px`
      }"
    >
      <p>æ¡Œå·ï¼š{{ hoverInfo.label }}</p>
      <p
        class="status-text"
        :style="{ color: hoverInfo.theme }"
      >
        <span
          class="status-dot"
          :style="{ backgroundColor: hoverInfo.theme }"
        ></span>
        {{ hoverInfo.statusText }}
      </p>
    </div>

    <!-- å³ä¾§åŒºåŸŸ -->
    <div class="store-panel">
      <!-- é¡¶éƒ¨æ—¶é—´åŒºåŸŸ -->
      <div class="time-block">
        <div class="date">{{ currentDate }}</div>
        <div class="time">{{ currentTime }}</div>
      </div>

      <!-- ä»Šæ—¥è¥ä¸šé¢ -->
      

      <!-- å±‚å åŒº -->
      <div class="card-list-scrollable">
        <div
          class="table-card"
          v-for="(theme, tableId) in tableThemes"
          :key="tableId"
          :class="{ 'has-order': ordersData[tableId] }"
          :ref="el => { if (el) cardRefs[tableId] = el }"
        >
          <!-- é¡¶éƒ¨æ ‡ç­¾è¡Œ -->
          <div class="card-header" @click="toggleCard(tableId)">
            <span class="status-dot" :style="{ backgroundColor: THEMES[theme].seat }"></span>
            <span class="toggle-icon">{{ expandedCards[tableId] ? 'â–¼' : 'â–¶' }}</span>
            <span class="card-title">{{ tableId }}ï¼ˆ{{ THEME_STATUS_MAP[theme] }}ï¼‰</span>
          </div>

          <!-- å±•å¼€åŒºåŸŸ -->
          <Transition name="slide-fade">
            <div v-if="expandedCards[tableId]" class="card-content">
              <!-- ç©ºé—²çŠ¶æ€æ˜¾ç¤º -->
              <div v-if="theme === 'green'" class="empty-state">
                <p>å½“å‰æ¡Œä½ç©ºé—²</p>
                <button @click="startNewOrder(tableId)">å¼€å§‹æ–°è®¢å•</button>
              </div>

              <!-- ç‚¹èœä¸­çŠ¶æ€æ˜¾ç¤º -->
              <div v-else-if="theme === 'blue'" class="ordering-state">
                <p>é¡¾å®¢æ­£åœ¨ç‚¹èœ...</p>
              </div>

              <!-- æœ‰è®¢å•çŠ¶æ€æ˜¾ç¤º -->
              <div v-else class="order-info">
                <div class="order-header">
                  <h3>è®¢å•å·ï¼š{{ ordersData[tableId]?.orderId }}</h3>
                  <span class="order-status" :style="{ color: THEMES[theme].text }">
                    {{ THEME_STATUS_MAP[theme] }}
                  </span>
                </div>

                <div class="customer-info">
                  <p>å®¢æˆ·ï¼š{{ ordersData[tableId]?.customer }}</p>
                  <p>ä¸‹å•æ—¶é—´ï¼š{{ ordersData[tableId]?.createdAt }}</p>
                </div>

                <div class="order-items">
                  <h4>èœå“æ¸…å•ï¼š</h4>
                  <ul>
                    <li v-for="(item, index) in ordersData[tableId]?.items" :key="index">
                      <span class="item-name">{{ item.name }}</span>
                      <span class="item-quantity">Ã—{{ item.quantity }}</span>
                      <span class="item-price">Â¥{{ (item.price * item.quantity).toFixed(2) }}</span>
                    </li>
                  </ul>
                </div>

                <div class="order-footer">
                  <div class="total-amount">
                    æ€»è®¡ï¼š<span>Â¥{{ ordersData[tableId]?.amount.toFixed(2) }}</span>
                  </div>
                  <div class="action-buttons">
                    <div class="action-buttons">
                      <button 
                        v-if="theme === 'yellow'" 
                        @click="openModal('serve', ordersData[tableId]?.orderId, ordersData[tableId]?.tableId)"
                        class="serve-btn"
                      >
                        <i class="icon-check"></i> ç¡®è®¤ä¸Šèœ
                      </button>
                      
                      <button 
                        v-if="theme === 'yellow'" 
                        @click="openModal('cancel', ordersData[tableId]?.orderId, ordersData[tableId]?.tableId)"
                        class="cancel-btn-1"
                      >
                        <i class="icon-close"></i> å–æ¶ˆè®¢å•
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </Transition>
        </div>
      </div>

    </div>

  </div>
  <!-- ç¡®è®¤å¼¹çª— -->
  <teleport to="body">
    <div v-if="showModal" class="modal-overlay">
      <div class="modal-box">
        <h3>{{ modalTitle }} ?</h3>
        <div class="modal-actions">
          <button class="cancel-btn" @click="showModal = false">å–æ¶ˆ</button>
          <button class="confirm-btn" @click="confirmAction">ç¡®è®¤</button>
        </div>
      </div>
    </div>
  </teleport>
</template>

<script setup>
  // ç›®å‰æ— éœ€è„šæœ¬ï¼Œåç»­å¯åœ¨è¿™é‡Œç»‘å®šæ¡Œä½çŠ¶æ€ã€ç‚¹å‡»äº¤äº’ç­‰
  import { ref, onMounted, nextTick, onUnmounted, reactive, watch } from 'vue'
  import PartitionWall from '@/components/PartitionWall.vue'
  import RestaurantTable from '@/components/RestaurantTable.vue'
  import { getTableStatusList, getOrderDetail } from '@/api/table'
  import { markOrderAsServed, cancelOrder } from '@/api/order'
  import { ElMessage } from 'element-plus';

  const currentDate = ref('')
  const currentTime = ref('')
  const THEMES = {
      green : { bg:'#d5eadb', border:'#71ac7a', seat:'#71ac7a', text:'#184b29' },
      blue  : { bg:'#d6e8ff', border:'#4d88ff', seat:'#4d88ff', text:'#003a8c' },
      yellow: { bg:'#fff8cc', border:'#e6c200', seat:'#e6c200', text:'#795900' },
      orange: { bg:'#ffe6d3', border:'#ff944d', seat:'#ff944d', text:'#a34700' },
      red   : { bg:'#ffd8d8', border:'#ff4d4f', seat:'#ff4d4f', text:'#a8071a' },
      black : { bg:'#d9d9d9', border:'#595959', seat:'#595959', text:'#141414' },
      deepblue: {bg: '#cce0ff', border: '#003366', seat: '#003366', text: '#001d3d'}
  }
  
  const THEME_STATUS_MAP = {
    green:  'ç©ºé—²',
    blue:   'ç‚¹èœä¸­',
    yellow: 'å¾…é¤ä¸­',
    orange: 'å¾…é¤è¾ƒä¹…',
    red:    'å¾…é¤è¿‡ä¹…',
    black:  'æ•…éšœä¸­',
    deepblue: 'å¾…æ”¯ä»˜'
  }

  const STATUS_THEME_MAP = {
    'ç©ºé—²': 'green',
    'ç‚¹èœä¸­': 'blue',
    'å¾…é¤ä¸­': 'yellow',
    'å¾…é¤è¾ƒä¹…': 'orange',
    'å¾…é¤è¿‡ä¹…': 'red',
    'æ•…éšœä¸­': 'black',
    'å¾…æ”¯ä»˜': 'deepblue'
  }



  /** æ‰€æœ‰æ¡Œå·åŠå…¶åˆå§‹ä¸»é¢˜ï¼ˆå…¨éƒ¨è®¾ä¸º greenï¼‰ */
  const tableThemes = ref({
    T1: 'green', T2: 'green', T3: 'green', T4: 'green',
    T5: 'green', T6: 'green', T7: 'green', T8: 'green',
    T9: 'green', T10: 'green', T11: 'green', T12: 'green',
    T13: 'green', T14: 'green', T15: 'green', T16: 'green',
    T17: 'green', T18: 'green', T19: 'green', T20: 'green'
  })

  // ç›‘å¬æ•´ä¸ª tableThemes
  watch(
    () => ({ ...tableThemes.value }), // åˆ›å»ºæ–°å¯¹è±¡ç¡®ä¿è§¦å‘
    (newVal) => {
      console.log('tableThemes å˜åŒ–:', newVal)
    },
    { deep: true }
  )

  const expandedCards = ref({
    T1: false, T2: false, T3: false, T4: false,
    T5: false, T6: false, T7: false, T8: false,
    T9: false, T10: false, T11: false, T12: false,
    T13: false, T14: false, T15: false, T16: false,
    T17: false, T18: false, T19: false, T20: false
  })
  const cardRefs = ref({})
  /**
   * åˆ‡æ¢æŸä¸ªæ¡Œå·çš„ä¸»é¢˜é¢œè‰²
   * @param tableNo æ¡Œå·ï¼ˆå¦‚ T1ï¼‰
   * @param theme æ–°ä¸»é¢˜ï¼ˆæ”¯æŒå…­ç§ï¼‰
   */
  function setTableTheme(tableNo, theme) {
    if (tableThemes.value[tableNo] !== undefined) {
      tableThemes.value[tableNo] = theme // æ­£ç¡®ä½¿ç”¨ .value
    } else {
      console.warn(`æ¡Œå· ${tableNo} ä¸å­˜åœ¨äº tableThemes ä¸­`)
    }
  }
  // setTableTheme('T1', 'blue');

  let intervalId;

  onMounted(() => {
    updateClock()
    setInterval(updateClock, 1000)
    updateTableThemesFromBackend(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
    intervalId = setInterval(updateTableThemesFromBackend, 1000);
  });

  onUnmounted(() => {
    clearInterval(intervalId);
  });

  const ordersData = ref({});

  async function updateTableThemesFromBackend() {
    try {
      const res = await getTableStatusList();
      if (res.data && Array.isArray(res.data)) {
        for (const item of res.data) {
          const key = `T${item.table_id}`;
          const theme = STATUS_THEME_MAP[item.status];
          if (theme) {
            setTableTheme(key, theme);
          }

          // ğŸ‘‡ å¦‚æœæœ‰è®¢å•å·å°±æŸ¥è¯¦æƒ…å¹¶æ›´æ–° ordersData
          if (item.current_order_id) {
            try {
              const orderRes = await getOrderDetail(item.current_order_id);
              ordersData.value[key] = {
                orderId: orderRes.order_id,
                tableId: orderRes.table_id,
                customer: `${orderRes.user.name}`,
                createdAt: orderRes.created_at,
                amount: orderRes.total_price,
                status: orderRes.status,
                items: orderRes.items.map(i => ({
                  name: i.name,
                  price: i.price,
                  quantity: i.quantity
                }))
              };
              console.log(ordersData.value)
            } catch (err) {
              console.error(`è·å–è®¢å• ${item.order_id} å¤±è´¥:`, err);
            }
          } else {
            delete ordersData[key]; // è‹¥æ— è®¢å•ï¼Œåˆ™æ¸…ç©ºè¯¥æ¡Œè®¢å•ä¿¡æ¯
          }
        }
      }
    } catch (err) {
      console.error('æ¡Œä½çŠ¶æ€è·å–å¤±è´¥:', err);
    }
  }



  const hoverInfo = ref({
    visible: false,
    label: '',
    theme: '',
    statusText: '',
    x: 0,
    y: 0
  })

  function showHoverInfo(label, theme, event) {
    const rect = event.getBoundingClientRect()
    const color = THEMES[theme] ?? THEMES.green
    hoverInfo.value = {
      visible: true,
      label,
      theme: color.seat,
      statusText: THEME_STATUS_MAP[theme] ?? 'æœªçŸ¥çŠ¶æ€',
      x: rect.left + rect.width / 2,
      y: rect.top - 12 // å‘ä¸Šåç§»
    }
  }

  function hideHoverInfo() {
    hoverInfo.value.visible = false
  }
 


  // å³è¾¹é€»è¾‘
  function updateClock() {
    const now = new Date()
    const y = now.getFullYear()
    const m = now.getMonth() + 1
    const d = now.getDate()
    currentDate.value = `${y}å¹´${m}æœˆ${d}æ—¥`

    const h = now.getHours().toString().padStart(2, '0')
    const min = now.getMinutes().toString().padStart(2, '0')
    const s = now.getSeconds().toString().padStart(2, '0')
    currentTime.value = `${h}:${min}:${s}`

  }


  function toggleCard(tableId) {
    expandedCards.value[tableId] = !expandedCards.value[tableId]
  }


  /** ç‚¹å‡»æ¡Œå­åï¼Œè‡ªåŠ¨å±•å¼€å¯¹åº”å¡ç‰‡å¹¶æ»šåŠ¨åˆ°å…¶ä½ç½® */
  function expandAndScrollTo(tableId) {
    // å¯é€‰ï¼šå…ˆå…³é—­å…¶ä»–é¡¹ï¼ˆå•å¼€æ¨¡å¼ï¼‰
    Object.keys(expandedCards.value).forEach(id => expandedCards.value[id] = false)

    expandedCards.value[tableId] = true

    // ç­‰å¾… DOM æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œæ»šåŠ¨
    nextTick(() => {
      const targetEl = cardRefs.value[tableId]
      if (targetEl) {
        targetEl.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        })
      }
    })
  }

  const showModal = ref(false);
  const modalTitle = ref('');
  const modalAction = ref('');
  const currentOrderId = ref(null);
  const currentTableId = ref(null);

  // æ‰“å¼€å¼¹çª—
  const openModal = (action, orderId, tableId) => {
    modalAction.value = action;
    currentOrderId.value = orderId;
    currentTableId.value = tableId;
    
    switch(action) {
      case 'serve':
        modalTitle.value = 'ç¡®è®¤å·²ä¸Šèœå®Œæˆ';
        break;
      case 'cancel':
        modalTitle.value = 'ç¡®è®¤è¦å–æ¶ˆæ­¤è®¢å•';
        break;
    }
    
    showModal.value = true;
  };

  // ç¡®è®¤æ“ä½œ
  const confirmAction = async () => {
    try {
      if (modalAction.value === 'serve') {
        await markOrderAsServed(currentOrderId.value, currentTableId.value);
        ElMessage.success('å·²ç¡®è®¤ä¸Šèœå®Œæˆ');
      } else if (modalAction.value === 'cancel') {
        await cancelOrder(currentOrderId.value, currentTableId.value);
        ElMessage.success('è®¢å•å·²å–æ¶ˆ');
      }
      
      updateTableThemesFromBackend();// é‡æ–°è·å–è®¢å•æ•°æ®
      showModal.value = false; // å…³é—­å¼¹çª—
    } catch (error) {
      ElMessage.error(`æ“ä½œå¤±è´¥: ${error.message}`);
    }
  };
</script>

<style scoped>
/* æ•´ä½“å·¦å³æ’å¸ƒ */
.store-wrapper {
  display: flex;
  gap: 36px;
  height: 100%;
}

/* ===== æ¥¼é¢å›¾åŒºåŸŸ ===== */
.floorplan {
  position: relative;
  width: 840px;         /* æ ¹æ®ä¾§è¾¹æ å®½åº¦è‡ªè¡Œè°ƒèŠ‚ */
  height: 627px;
  background: #fafafa;
  border: 10px solid #71ac7a;
  border-radius: 8px;
  padding: 16px;
}

/* å¤§é—¨ */
.door{
  position:absolute;top:-2px;left:50%;translate:-50% 0;
  width:160px;height:14px;
  background:#8d8d8d;border-radius:0 0 6px 6px;
}

/* å‰å° */
.counter{
  position:absolute;top:150px;left:50%;translate:-50% 0;
  width:220px;height:48px;
  background:#65ac7b;color:#fff;
  display:flex;justify-content:center;align-items:center;
  border-radius:6px;font-size:16px;font-weight:600;
}

.table-tooltip {
  position: fixed;
  transform: translate(-50%, -100%);
  background: white;
  border: 1px solid #ccc;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 14px;
  color: #333;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  pointer-events: none;
  z-index: 999;
}

.status-text {
  display: flex;
  align-items: center;
  gap: 6px;
  margin: 4px 0;
  font-size: 14px;
  font-weight: 500;
}

.status-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  display: inline-block;
}


/* ===== å³ä¾§åŒºåŸŸ ===== */
.store-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 24px;
  font-family: sans-serif;
  color: #333;
  background: #fff;
  border: 2px solid #d9f0e1;
  box-sizing: border-box;
  border-radius: 8px;
}

.time-block {
  text-align: left;
  margin-bottom: 24px;
}

.date {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 6px;
}

.time {
  font-size: 24px;
  font-weight: bold;
  color: #71ac7a;
}

.revenue-block {
  font-size: 18px;
  background: #f4f8f9;
  border: 1px solid #e0e0e0;
  padding: 16px 20px;
  border-radius: 8px;
  margin-bottom: 24px;
}

.symbol {
  font-size: 20px;
  color: #f56c6c;
  margin: 0 4px;
}

.amount {
  font-size: 28px;
  font-weight: bold;
  color: #f56c6c;
}

/* å¡ç‰‡åˆ—è¡¨åŒºåŸŸ */
.card-list-scrollable {
  width: 350px;
  max-height: 100%;
  overflow-y: auto;
  padding-right: 4px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.table-card {
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  background: #fff;
  box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  padding: 12px 14px;
  transition: all 0.3s;
  cursor: pointer;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
  font-size: 15px;
}

.status-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
}

.toggle-icon {
  font-size: 12px;
  color: #888;
}

.card-title {
  flex-grow: 1;
}

.card-content {
  margin-top: 10px;
  padding-left: 24px;
  font-size: 14px;
  color: #444;
}

/* å±•å¼€å†…å®¹æ ·å¼ */
.card-content {
  padding: 16px;
  border-top: 1px solid #eee;
}

.empty-state {
  text-align: center;
  padding: 20px 0;
  color: #888;
}

.empty-state button {
  margin-top: 10px;
  padding: 6px 12px;
  background: #4d88ff;
  color: white;
  border: none;
  border-radius: 4px;
}

.order-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}

.order-status {
  font-weight: bold;
}

.customer-info p {
  margin: 4px 0;
  color: #666;
}

.order-items {
  margin: 16px 0;
}

.order-items ul {
  list-style: none;
  padding: 0;
  margin: 8px 0;
}

.order-items li {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px dashed #eee;
}

.item-name {
  flex: 2;
}

.item-quantity {
  flex: 1;
  text-align: center;
}

.item-price {
  flex: 1;
  text-align: right;
}

.order-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px solid #eee;
}

.total-amount span {
  font-weight: bold;
  color: #f56c6c;
  font-size: 18px;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-top: 16px;
  justify-content: flex-end;
}

/* ç¡®è®¤æŒ‰é’®æ ·å¼ */
.serve-btn {
  background-color: #65ac7b;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(101, 172, 123, 0.3);
}

.serve-btn:hover {
  background-color: #4c9966;
  transform: translateY(-1px);
  box-shadow: 0 3px 6px rgba(101, 172, 123, 0.4);
}

.serve-btn:active {
  transform: translateY(0);
}

/* å–æ¶ˆæŒ‰é’®æ ·å¼ */
.cancel-btn-1 {
  background-color: #fff1f0;
  color: #f5222d;
  border: 1px solid #ffa39e;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s ease;
}

.cancel-btn-1:hover {
  background-color: #ffccc7;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(245, 34, 45, 0.1);
}

.cancel-btn-1:active {
  transform: translateY(0);
}

/* å›¾æ ‡æ ·å¼ï¼ˆå¯ä»¥ä½¿ç”¨å­—ä½“å›¾æ ‡æˆ–SVGï¼‰ */
.icon-check {
  display: inline-block;
  width: 14px;
  height: 14px;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>') no-repeat center;
}

.icon-close {
  display: inline-block;
  width: 14px;
  height: 14px;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23f5222d"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>') no-repeat center;
}

/* è¿‡æ¸¡åŠ¨ç”» */
.slide-fade-enter-active {
  transition: all 0.3s ease-out;
}

.slide-fade-leave-active {
  transition: all 0.2s cubic-bezier(1, 0.5, 0.8, 1);
}

.slide-fade-enter-from,
.slide-fade-leave-to {
  transform: translateY(-10px);
  opacity: 0;
}

.ordering-state {
  padding: 16px;
  text-align: center;
}

.ordering-state p {
  color: #666;
  margin-bottom: 16px;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-box {
  background: #fff;
  border-radius: 8px;
  padding: 24px;
  width: 300px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.modal-box h3 {
  margin-bottom: 16px;
  font-size: 18px;
  color: #333;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  margin-top: 10px;
  gap: 10px;
}

.confirm-btn {
  background-color: #65ac7b;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
}

.confirm-btn:hover {
  background-color: #4c9966;
}

.cancel-btn {
  background-color: #ccc;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
}

.cancel-btn:hover {
  background-color: #c1c1c1;
}

</style>
